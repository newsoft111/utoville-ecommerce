{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load humanize %}


<!--Page header start-->
<section class="position-relative overflow-hidden">
	<div class="py-8 py-lg-11 bg-dark text-white position-relative">
		<!--background image-->
		<img src="{% static 'img/shop/banners/06.jpg' %}" class="bg-image bg-top-center opacity-75" alt="">
	
		<div class="row align-items-center position-relative">
		<div class="col-lg-10 mx-auto text-center">
			<nav class="d-flex justify-content-center" aria-label="breadcrumb">
			<ol class="breadcrumb mb-3">
				<li class="breadcrumb-item">
				<a href="#!">Home</a>
				</li>
				<li class="breadcrumb-item active">
				Shop
				</li>
			</ol>
			</nav>
			<h1 class="mb-0 display-3">Shop
			</h1>
		</div>
		</div>
		<!--/.row-->
	</div>
</section>

<section class="row mydata my-5">
	<div id="chart" class="col-md-4"></div>
	<div id="chart" class="col-md-4"></div>
</section>

<section class="position-relative bg-white">
	<div class="container position-relative">
		<div class="row justify-content-between">
			<div class="col-md-3">
				<!--:Sidebar widget card-->
				<div class="mt-5">
					<!--:Title-->
					<h6 class="mb-4">Categories</h6>
					<!--:Collapse categories-->
					<div class="collapse-group collapse d-flex flex-column">
						<div class="collapse d-block">
							<div class="nav flex-column">
								{% for categoryFirst in category_first_list %}
								<a href="#category{{categoryFirst.id}}" class="nav-link" data-bs-toggle="collapse" aria-expanded="false">{{categoryFirst.name}}</a>
								<div class="collapse" id="category{{categoryFirst.id}}">
								<div class="nav nav-level-2 flex-column">
									{% for categorySecond in categoryFirst.categorysecond_set.all %}
									<a href="?category1={{categoryFirst.id}}&category2={{categorySecond.id}}" class="nav-link small">{{categorySecond.name}}</a>
									{% endfor %}
								</div>
								</div>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
				<!--:Sidebar widget card-->
			</div>

<!--Products column-->
<div class="col-md-9 pt-5">
<!--Products top bar-->
<div class="row mb-5 align-items-center">
  <div class="col-md-5 mb-3 mb-md-0">
	<small>Showing 1-9 of 190 items</small>
  </div>
  <div class="col-md-6 ms-auto">
	<div class="d-flex align-items-center">
		<span class="small text-muted text-end me-3 d-none d-lg-block w-100">Short by</span>
		
		<select name="sort_by" class="form-control" id="sort-by">
			<option value="id" selected> Most recent</option>
			<option value="rating_count"> Best selling</option>
			<option value="rating"> Best rated</option>
			<option value="price"> Price - Low to High</option>
			<option value="-price">Price - High to Low</option>
		</select>

	</div>
  </div>
</div>
<div class="row mb-5">
	{% for productList in product_list %}
	<div class="col-md-6 col-xl-4 mb-4">
		<!--:card-hover-expand-->
		<div class="card overflow-hidden hover-lift card-product">
		<div class="card-product-header p-3 d-block overflow-hidden position-relative">
			<a href="{% url 'product:detail' productList.id %}">
				<img src="{% static 'img/shop/products/03.jpg' %}" class="img-fluid" alt="Product">
			</a>
		</div>
		<div class="card-product-body p-3 pt-0 text-center">
			<a href="{% url 'product:detail' productList.id %}" class="h5 text-dark d-block position-relative mb-2">{{productList.name}}</a>
			<div class="card-product-body-overlay">
			<span class="card-product-price">
				<span>₱{{productList.price|intcomma}}</span>
			</span>
			<span class="card-product-view-btn">
				<a href="{% url 'product:detail' productList.id %}" class="link-underline mb-1 fw-semibold text-dark">View Details</a>
			</span>
			</div>
		</div>
		</div>
		<!--:/card product end-->
	</div>
	{% endfor %}
</div>

<div class="row mb-5">
	<ul class="pagination justify-content-center m-0">
		{% if product_list.has_previous %}
		<li class="page-item ">
			<a class="page-link" href="?p={{product_list.previous_page_number }}{% if 'channel' in request.GET %}&channel={{request.GET.channel}}{% endif %}{% if 'type' in request.GET %}&type={{request.GET.type}}{% endif %}">이전</a>
		</li>
		{% else %}
		<li class="page-item disabled">
			<span class="page-link">이전</span>
		</li>
		{% endif %}

		{% for page_number in product_list.paginator.page_range %}
			{% if page_number >= product_list.number|add:-2 and page_number <= product_list.number|add:2 %}
				{% if page_number == product_list.number %}
				<li class="page-item active">
					<span class="page-link">{{ page_number }}</span>
				</li>
				{% else %}
				<li class="page-item">
						<a class="page-link" href="?p={{page_number }}{% if 'channel' in request.GET %}&channel={{request.GET.channel}}{% endif %}{% if 'type' in request.GET %}&type={{request.GET.type}}{% endif %}">{{ page_number }}</a>
				</li>
				{% endif %}
			{% endif %}
		{% endfor %}

		{% if product_list.has_next  %}
		<li class="page-item">
			<a class="page-link" href="?p={{product_list.next_page_number }}{% if 'channel' in request.GET %}&channel={{request.GET.channel}}{% endif %}{% if 'type' in request.GET %}&type={{request.GET.type}}{% endif %}">다음</a> 
		</li>
		{% else %}
		<li class="page-item disabled">
			<span class="page-link">다음</span>
		</li>
		{% endif %}
	</ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="{% static 'vendor/node_modules/js/moment.js' %}"></script>
<script>
$(document).ready(function() {
	const urlParams = new URLSearchParams(window.location.search);
	let sort = urlParams.get('sort');
	if (isEmpty(sort)) {
		sort = 'id';
	}
	console.log(sort);

	let element = document.getElementById("sort-by");
    element.value = sort;
});

const sort = document.querySelector('select[name=sort_by]');

sort.addEventListener('change', (event) => {
	var link = `{{request.path}}?sort=${event.target.value}`;
	location.href=link;
});

var options = {
	series: [{
		data: [
			{
				x: 'Analysis',
				y: [
					new Date('2019-02-27').getTime(),
					new Date('2019-03-04').getTime()
				],
				fillColor: '#008FFB'
			},
			{
				x: 'Design',
				y: [
					new Date('2019-03-04').getTime(),
					new Date('2019-03-08').getTime()
				],
				fillColor: '#00E396'
			},
			{
				x: 'Coding',
				y: [
					new Date('2019-03-07').getTime(),
					new Date('2019-03-10').getTime()
				],
				fillColor: '#775DD0'
			},
			{
				x: 'Testing',
				y: [
					new Date('2019-03-08').getTime(),
					new Date('2019-03-12').getTime()
				],
				fillColor: '#FEB019'
			},
			{
				x: 'Deployment',
				y: [
					new Date('2019-03-12').getTime(),
					new Date('2019-03-17').getTime()
				],
				fillColor: '#FF4560'
			}
		]
	}],
	chart: {
		height: 350,
		type: 'rangeBar'
	},
	plotOptions: {
		bar: {
			horizontal: true,
			distributed: true,
			dataLabels: {
				hideOverflowingLabels: false
			}
		}
	},
	tooltip: {
		enabled: false,
	},
	dataLabels: {
		enabled: true,
		formatter: function(val, opts) {
			var label = opts.w.globals.labels[opts.dataPointIndex]
			var a = moment(val[0])
			var b = moment(val[1])
			var diff = b.diff(a, 'days')
			return label + ': ' + diff + (diff > 1 ? ' days' : ' day')
		},
		style: {
			colors: ['#f3f4f5', '#fff']
		}
	},
	xaxis: {
		type: 'datetime'
	},
	yaxis: {
		show: false
	},
	grid: {
		row: {
			colors: ['#f3f4f5', '#fff'],
			opacity: 1
		}
	}
};

var chart = new ApexCharts(document.querySelector("#chart"), options);
chart.render();

</script>

{% endblock %}